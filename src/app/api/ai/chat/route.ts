import { NextRequest, NextResponse } from 'next/server';
import { db } from '@/db';
import { chatHistory } from '@/db/schema';

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { message, userId, language } = body;

    if (!message || !userId) {
      return NextResponse.json(
        { error: 'Message and user ID are required' },
        { status: 400 }
      );
    }

    // Simulate AI responses in Kannada (In production, use OpenAI API or similar)
    const responses: { [key: string]: string } = {
      '‡≤ü‡≥ä‡≤Æ‡≥á‡≤ü‡≥ä': `üçÖ ‡≤ü‡≥ä‡≤Æ‡≥á‡≤ü‡≥ä ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤Æ‡≤æ‡≤π‡≤ø‡≤§‡≤ø:

‡≤Æ‡≤£‡≥ç‡≤£‡≥Å: ‡≤ö‡≥Ü‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø ‡≤í‡≤≥‡≤ö‡≤∞‡≤Ç‡≤°‡≤ø‡≤Ø‡≤æ‡≤¶ ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å, pH 6.0-7.0
‡≤π‡≤µ‡≤æ‡≤Æ‡≤æ‡≤®: 20-25¬∞C ‡≤§‡≤æ‡≤™‡≤Æ‡≤æ‡≤®
‡≤®‡≥Ä‡≤∞‡≥Å: ‡≤®‡≤ø‡≤Ø‡≤Æ‡≤ø‡≤§ ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤Ö‡≤ó‡≤§‡≥ç‡≤Ø

‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤∏‡≤≤‡≤π‡≥Ü‡≤ó‡≤≥‡≥Å:
- ‡≤¨‡≥Ä‡≤ú‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≤∞‡≥ç‡≤∏‡≤∞‡≤ø‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Æ‡≥ä‡≤≥‡≤ï‡≥Ü ‡≤π‡≤æ‡≤ï‡≤ø
- 30-45 ‡≤¶‡≤ø‡≤®‡≤ó‡≤≥ ‡≤®‡≤Ç‡≤§‡≤∞ ‡≤®‡≥Ü‡≤ü‡≥ç‡≤ü‡≥Å ‡≤Æ‡≤æ‡≤°‡≤ø
- ‡≤∏‡≤æ‡≤µ‡≤Ø‡≤µ ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞ ‡≤¨‡≤≥‡≤∏‡≤ø
- ‡≤∞‡≥ã‡≤ó ‡≤®‡≤ø‡≤Ø‡≤Ç‡≤§‡≥ç‡≤∞‡≤£‡≤ï‡≥ç‡≤ï‡≥Ü ‡≤ó‡≤Æ‡≤®‡≤ø‡≤∏‡≤ø

‡≤á‡≤≥‡≥Å‡≤µ‡≤∞‡≤ø: 60-70 ‡≤¶‡≤ø‡≤®‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∏‡≤ø‡≤¶‡≥ç‡≤ß`,

      '‡≤Ü‡≤≤‡≥Ç‡≤ó‡≤°‡≥ç‡≤°‡≥Ü': `ü•î ‡≤Ü‡≤≤‡≥Ç‡≤ó‡≤°‡≥ç‡≤°‡≥Ü ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤Æ‡≤æ‡≤π‡≤ø‡≤§‡≤ø:

‡≤Æ‡≤£‡≥ç‡≤£‡≥Å: ‡≤Æ‡≤∞‡≤≥‡≥Å ‡≤Æ‡≤ü‡≥ç‡≤ü‡≤ø ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å, pH 5.5-6.5
‡≤π‡≤µ‡≤æ‡≤Æ‡≤æ‡≤®: 15-20¬∞C ‡≤§‡≤æ‡≤™‡≤Æ‡≤æ‡≤®
‡≤®‡≥Ä‡≤∞‡≥Å: ‡≤Æ‡≤ß‡≥ç‡≤Ø‡≤Æ ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø

‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤∏‡≤≤‡≤π‡≥Ü‡≤ó‡≤≥‡≥Å:
- ‡≤∏‡≤£‡≥ç‡≤£ ‡≤ó‡≥Ü‡≤°‡≥ç‡≤°‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥Ü‡≤ü‡≥ç‡≤ü‡≥Å ‡≤Æ‡≤æ‡≤°‡≤ø
- ‡≤∏‡≤æ‡≤≤‡≤ø‡≤®‡≤ø‡≤Ç‡≤¶ ‡≤∏‡≤æ‡≤≤‡≤ø‡≤ó‡≥Ü 60 ‡≤∏‡≥Ü‡≤Ç.‡≤Æ‡≥Ä ‡≤Ö‡≤Ç‡≤§‡≤∞
- ‡≤∏‡≤æ‡≤µ‡≤Ø‡≤µ ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞ ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å NPK ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞ ‡≤¨‡≤≥‡≤∏‡≤ø
- ‡≤ï‡≤≥‡≥Ü ‡≤®‡≤ø‡≤Ø‡≤Ç‡≤§‡≥ç‡≤∞‡≤£ ‡≤Æ‡≤æ‡≤°‡≤ø

‡≤á‡≤≥‡≥Å‡≤µ‡≤∞‡≤ø: 90-120 ‡≤¶‡≤ø‡≤®‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∏‡≤ø‡≤¶‡≥ç‡≤ß`,

      '‡≤¨‡≤§‡≥ç‡≤§': `üåæ ‡≤¨‡≤§‡≥ç‡≤§ ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤Æ‡≤æ‡≤π‡≤ø‡≤§‡≤ø:

‡≤Æ‡≤£‡≥ç‡≤£‡≥Å: ‡≤Æ‡≤ü‡≥ç‡≤ü‡≤ø ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å, pH 5.5-7.0
‡≤π‡≤µ‡≤æ‡≤Æ‡≤æ‡≤®: 25-35¬∞C ‡≤§‡≤æ‡≤™‡≤Æ‡≤æ‡≤®, ‡≤Æ‡≤≥‡≥Ü‡≤ó‡≤æ‡≤≤
‡≤®‡≥Ä‡≤∞‡≥Å: ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≥Å ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤Ö‡≤ó‡≤§‡≥ç‡≤Ø

‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤∏‡≤≤‡≤π‡≥Ü‡≤ó‡≤≥‡≥Å:
- ‡≤≠‡≤¶‡≥ç‡≤∞‡≤§‡≤æ ‡≤¨‡≥Ä‡≤ú ‡≤¨‡≤≥‡≤∏‡≤ø
- ‡≤®‡≤∞‡≥ç‡≤∏‡≤∞‡≤ø‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Æ‡≥ä‡≤≥‡≤ï‡≥Ü ‡≤π‡≤æ‡≤ï‡≤ø
- 25-30 ‡≤¶‡≤ø‡≤®‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥Ü‡≤ü‡≥ç‡≤ü‡≥Å ‡≤Æ‡≤æ‡≤°‡≤ø
- ‡≤∏‡≤æ‡≤µ‡≤Ø‡≤µ ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞ ‡≤¨‡≤≥‡≤∏‡≤ø
- ‡≤ï‡≤≥‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤∞‡≥ã‡≤ó ‡≤®‡≤ø‡≤Ø‡≤Ç‡≤§‡≥ç‡≤∞‡≤£

‡≤á‡≤≥‡≥Å‡≤µ‡≤∞‡≤ø: 120-150 ‡≤¶‡≤ø‡≤®‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∏‡≤ø‡≤¶‡≥ç‡≤ß`,

      '‡≤Æ‡≤£‡≥ç‡≤£‡≤ø‡≤® pH': `üå± ‡≤Æ‡≤£‡≥ç‡≤£‡≤ø‡≤® pH ‡≤¨‡≤ó‡≥ç‡≤ó‡≥Ü:

pH ‡≤é‡≤Ç‡≤¶‡≤∞‡≥á‡≤®‡≥Å?
‡≤Æ‡≤£‡≥ç‡≤£‡≤ø‡≤® ‡≤Ü‡≤Æ‡≥ç‡≤≤‡≥Ä‡≤Ø‡≤§‡≥Ü ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤ï‡≥ç‡≤∑‡≤æ‡≤∞‡≥Ä‡≤Ø‡≤§‡≥Ü‡≤Ø ‡≤Æ‡≤æ‡≤™‡≤®.

pH ‡≤Æ‡≤ü‡≥ç‡≤ü‡≤ó‡≤≥‡≥Å:
- pH < 7: ‡≤Ü‡≤Æ‡≥ç‡≤≤‡≥Ä‡≤Ø ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å
- pH = 7: ‡≤§‡≤ü‡≤∏‡≥ç‡≤• ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å
- pH > 7: ‡≤ï‡≥ç‡≤∑‡≤æ‡≤∞‡≥Ä‡≤Ø ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å

‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≤ø‡≤® ‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤∏‡≥Ç‡≤ï‡≥ç‡≤§ pH: 6.0-7.5

pH ‡≤∏‡≤∞‡≤ø‡≤™‡≤°‡≤ø‡≤∏‡≥Å‡≤µ‡≥Å‡≤¶‡≥Å:
- ‡≤Ü‡≤Æ‡≥ç‡≤≤‡≥Ä‡≤Ø‡≤§‡≥Ü‡≤ó‡≥Ü: ‡≤∏‡≥Å‡≤£‡≥ç‡≤£ ‡≤∏‡≥á‡≤∞‡≤ø‡≤∏‡≤ø
- ‡≤ï‡≥ç‡≤∑‡≤æ‡≤∞‡≥Ä‡≤Ø‡≤§‡≥Ü‡≤ó‡≥Ü: ‡≤∏‡≤æ‡≤µ‡≤Ø‡≤µ ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞ ‡≤∏‡≥á‡≤∞‡≤ø‡≤∏‡≤ø`,

      '‡≤∏‡≤æ‡≤µ‡≤Ø‡≤µ ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞': `üåø ‡≤∏‡≤æ‡≤µ‡≤Ø‡≤µ ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞ ‡≤¨‡≤ó‡≥ç‡≤ó‡≥Ü:

‡≤™‡≥ç‡≤∞‡≤ï‡≤æ‡≤∞‡≤ó‡≤≥‡≥Å:
1. ‡≤π‡≤∏‡≥Å‡≤µ‡≤ø‡≤® ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞ üêÑ
2. ‡≤ï‡≥ã‡≤≥‡≤ø ‡≤∏‡≤ó‡≤£‡≤ø üêî
3. ‡≤µ‡≤∞‡≥ç‡≤Æ‡≤ø‡≤ï‡≤Ç‡≤™‡≥ã‡≤∏‡≥ç‡≤ü‡≥ç ü™±
4. ‡≤π‡≤∏‡≤ø‡≤∞‡≥Å ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞ üå±
5. ‡≤ï‡≤Ç‡≤™‡≥ã‡≤∏‡≥ç‡≤ü‡≥ç ‚ôªÔ∏è

‡≤™‡≥ç‡≤∞‡≤Ø‡≥ã‡≤ú‡≤®‡≤ó‡≤≥‡≥Å:
- ‡≤Æ‡≤£‡≥ç‡≤£‡≤ø‡≤® ‡≤´‡≤≤‡≤µ‡≤§‡≥ç‡≤§‡≤§‡≥Ü ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü
- ‡≤Æ‡≤£‡≥ç‡≤£‡≤ø‡≤® ‡≤∞‡≤ö‡≤®‡≥Ü ‡≤∏‡≥Å‡≤ß‡≤æ‡≤∞‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü
- ‡≤®‡≥Ä‡≤∞‡≥Å ‡≤π‡≤ø‡≤°‡≤ø‡≤Ø‡≥Å‡≤µ ‡≤∏‡≤æ‡≤Æ‡≤∞‡≥ç‡≤•‡≥ç‡≤Ø ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü
- ‡≤∞‡≤æ‡≤∏‡≤æ‡≤Ø‡≤®‡≤ø‡≤ï ‡≤Æ‡≥Å‡≤ï‡≥ç‡≤§ ‡≤¨‡≥Ü‡≤≥‡≥Ü
- ‡≤Æ‡≤£‡≥ç‡≤£‡≤ø‡≤® ‡≤∏‡≥Ç‡≤ï‡≥ç‡≤∑‡≥ç‡≤Æ‡≤ú‡≥Ä‡≤µ‡≤ø‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü

‡≤¨‡≤≥‡≤ï‡≥Ü: ‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤é‡≤ï‡≤∞‡≥Ü‡≤ó‡≥Ü 5-10 ‡≤ü‡≤®‡≥ç`,

      '‡≤Æ‡≤æ‡≤®‡≥ç‡≤∏‡≥Ç‡≤®‡≥ç': `üåßÔ∏è ‡≤Æ‡≤æ‡≤®‡≥ç‡≤∏‡≥Ç‡≤®‡≥ç ‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤ó‡≤≥‡≥Å:

‡≤ñ‡≤∞‡≥Ä‡≤´‡≥ç ‡≤ã‡≤§‡≥Å ‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤ó‡≤≥‡≥Å (‡≤ú‡≥Ç‡≤®‡≥ç-‡≤Ö‡≤ï‡≥ç‡≤ü‡≥ã‡≤¨‡≤∞‡≥ç):
1. ‡≤¨‡≤§‡≥ç‡≤§ üåæ
2. ‡≤ú‡≥ã‡≤≥ üåΩ
3. ‡≤∞‡≤æ‡≤ó‡≤ø üåæ
4. ‡≤ï‡≤¨‡≥ç‡≤¨‡≥Å üéã
5. ‡≤π‡≤§‡≥ç‡≤§‡≤ø ‚òÅÔ∏è
6. ‡≤∏‡≥ã‡≤Ø‡≤æ‡≤¨‡≥Ä‡≤®‡≥ç üå±
7. ‡≤ï‡≤°‡≤≤‡≥Ü‡≤ï‡≤æ‡≤Ø‡≤ø ü•ú
8. ‡≤§‡≥Ç‡≤∞‡≥Å üåæ

‡≤∏‡≤≤‡≤π‡≥Ü‡≤ó‡≤≥‡≥Å:
- ‡≤Æ‡≤≥‡≥Ü‡≤ó‡≤æ‡≤≤‡≤ï‡≥ç‡≤ï‡≥Ü ‡≤Æ‡≥ä‡≤¶‡≤≤‡≥Å ‡≤®‡≥Ü‡≤ü‡≥ç‡≤ü‡≥Å ‡≤Æ‡≤æ‡≤°‡≤ø
- ‡≤í‡≤≥‡≤ö‡≤∞‡≤Ç‡≤°‡≤ø ‡≤µ‡≥ç‡≤Ø‡≤µ‡≤∏‡≥ç‡≤•‡≥Ü ‡≤á‡≤∞‡≤ø‡≤∏‡≤ø
- ‡≤π‡≤µ‡≤æ‡≤Æ‡≤æ‡≤® ‡≤Æ‡≥Å‡≤®‡≥ç‡≤∏‡≥Ç‡≤ö‡≤®‡≥Ü ‡≤®‡≥ã‡≤°‡≤ø
- ‡≤≠‡≤¶‡≥ç‡≤∞‡≤§‡≤æ ‡≤¨‡≥Ä‡≤ú ‡≤¨‡≤≥‡≤∏‡≤ø`,
    };

    // Generate AI response based on message content
    let aiResponse = '';
    const lowerMessage = message.toLowerCase();

    if (lowerMessage.includes('‡≤ü‡≥ä‡≤Æ‡≥á‡≤ü‡≥ä') || lowerMessage.includes('tomato')) {
      aiResponse = responses['‡≤ü‡≥ä‡≤Æ‡≥á‡≤ü‡≥ä'];
    } else if (lowerMessage.includes('‡≤Ü‡≤≤‡≥Ç‡≤ó‡≤°‡≥ç‡≤°‡≥Ü') || lowerMessage.includes('potato')) {
      aiResponse = responses['‡≤Ü‡≤≤‡≥Ç‡≤ó‡≤°‡≥ç‡≤°‡≥Ü'];
    } else if (lowerMessage.includes('‡≤¨‡≤§‡≥ç‡≤§') || lowerMessage.includes('rice')) {
      aiResponse = responses['‡≤¨‡≤§‡≥ç‡≤§'];
    } else if (lowerMessage.includes('ph') || lowerMessage.includes('‡≤™‡≤ø‡≤π‡≥Ü‡≤ö‡≥ç')) {
      aiResponse = responses['‡≤Æ‡≤£‡≥ç‡≤£‡≤ø‡≤® pH'];
    } else if (lowerMessage.includes('‡≤∏‡≤æ‡≤µ‡≤Ø‡≤µ') || lowerMessage.includes('‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞') || lowerMessage.includes('organic')) {
      aiResponse = responses['‡≤∏‡≤æ‡≤µ‡≤Ø‡≤µ ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞'];
    } else if (lowerMessage.includes('‡≤Æ‡≤æ‡≤®‡≥ç‡≤∏‡≥Ç‡≤®‡≥ç') || lowerMessage.includes('monsoon') || lowerMessage.includes('‡≤Æ‡≤≥‡≥Ü')) {
      aiResponse = responses['‡≤Æ‡≤æ‡≤®‡≥ç‡≤∏‡≥Ç‡≤®‡≥ç'];
    } else {
      aiResponse = `‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü‡≤ó‡≥Ü ‡≤ß‡≤®‡≥ç‡≤Ø‡≤µ‡≤æ‡≤¶‡≤ó‡≤≥‡≥Å! üôè

‡≤®‡≤æ‡≤®‡≥Å ‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤ï‡≥É‡≤∑‡≤ø‡≤Ø ‡≤¨‡≤ó‡≥ç‡≤ó‡≥Ü ‡≤∏‡≤π‡≤æ‡≤Ø ‡≤Æ‡≤æ‡≤°‡≤¨‡≤≤‡≥ç‡≤≤‡≥Ü:
- ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤Æ‡≤æ‡≤π‡≤ø‡≤§‡≤ø (‡≤ü‡≥ä‡≤Æ‡≥á‡≤ü‡≥ä, ‡≤¨‡≤§‡≥ç‡≤§, ‡≤Ü‡≤≤‡≥Ç‡≤ó‡≤°‡≥ç‡≤°‡≥Ü, ‡≤á‡≤§‡≥ç‡≤Ø‡≤æ‡≤¶‡≤ø)
- ‡≤Æ‡≤£‡≥ç‡≤£‡≤ø‡≤® pH ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤´‡≤≤‡≤µ‡≤§‡≥ç‡≤§‡≤§‡≥Ü
- ‡≤∏‡≤æ‡≤µ‡≤Ø‡≤µ ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞
- ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤µ‡≤ø‡≤ß‡≤æ‡≤®‡≤ó‡≤≥‡≥Å
- ‡≤∞‡≥ã‡≤ó ‡≤®‡≤ø‡≤Ø‡≤Ç‡≤§‡≥ç‡≤∞‡≤£
- ‡≤Æ‡≤æ‡≤®‡≥ç‡≤∏‡≥Ç‡≤®‡≥ç ‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤ó‡≤≥‡≥Å

‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Ü ‡≤ï‡≥á‡≤≥‡≤ø ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤Æ‡≥á‡≤≤‡≤ø‡≤® ‡≤µ‡≤ø‡≤∑‡≤Ø‡≤ó‡≤≥ ‡≤¨‡≤ó‡≥ç‡≤ó‡≥Ü ‡≤ï‡≥á‡≤≥‡≤ø. üå±`;
    }

    // Save chat to database
    await db.insert(chatHistory).values({
      userId,
      message,
      response: aiResponse,
      language: language || 'kannada',
      createdAt: new Date().toISOString(),
    });

    return NextResponse.json({ response: aiResponse }, { status: 200 });

  } catch (error) {
    console.error('Chat error:', error);
    return NextResponse.json(
      { error: 'Internal server error: ' + error },
      { status: 500 }
    );
  }
}